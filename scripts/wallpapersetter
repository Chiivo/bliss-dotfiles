#!/bin/sh

#Make sure to add 'kill $(pgrep -f path/to/script);' to your startup script before 'path/to/script &' to avoid weird flickering

### Variables ###
morning='/mnt/HDD/Images/Wallpapers/Outset Island/Outset Island morning.jpg'
day='/mnt/HDD/Images/Wallpapers/Outset Island/Outset Island day.jpg'
evening='/mnt/HDD/Images/Wallpapers/Outset Island/Outset Island evening.jpg'
night='/mnt/HDD/Images/Wallpapers/Outset Island/Outset Island night.jpg'
basecheck='true'
morningcheck='false'
daycheck='false'
eveningcheck='false'
nightcheck='false'

### Functions ###
checkmorning() {
	for i in {100..0}; do
		gm convert "$morning" -fill "#262727" -colorize "$i" jpg:- | feh --bg-scale --no-fehbg -
	done
	morningcheck='false'
	daycheck='true'
	basecheck='false'
}

checkday() {
	for i in {100..0}; do
		gm convert "$day" -fill "#262727" -colorize "$i" jpg:- | feh --bg-scale --no-fehbg -
	done
	daycheck='false'
	eveningcheck='true'
	basecheck='false'
}

checkevening() {
	for i in {100..0}; do
		gm convert "$evening" -fill "#262727" -colorize "$i" jpg:- | feh --bg-scale --no-fehbg -
	done
	eveningcheck='false'
	nightcheck='true'
	basecheck='false'
}

checknight() {
	for i in {100..0}; do
		gm convert "$night" -fill "#262727" -colorize "$i" jpg:- | feh --bg-scale --no-fehbg -
	done
	nightcheck='false'
	morningcheck='true'
	basecheck='false'
}

transmorning() {
	for i in {100..0}; do
		gm composite "$night" -dissolve "$i" "$morning" jpg:- | feh --bg-scale --no-fehbg -
	done
	morningcheck='false'
	daycheck='true'
}

transday() {
	for i in {100..0}; do
		gm composite "$morning" -dissolve "$i" "$day" jpg:- | feh --bg-scale --no-fehbg -
	done
	daycheck='false'
	eveningcheck='true'
}

transevening() {
	for i in {100..0}; do
		gm composite "$day" -dissolve "$i" "$evening" jpg:- | feh --bg-scale --no-fehbg -
	done
	eveningcheck='false'
	nightcheck='true'
}

transnight() {
	for i in {100..0}; do
		gm composite "$evening" -dissolve "$i" "$night" jpg:- | feh --bg-scale --no-fehbg -
	done
	nightcheck='false'
	morningcheck='true'
}

### Script ###
while :
do
	#Check time each loop
	time=$(date +%H%M)
	#Set wallpaper based on time on first run
	if [ "$basecheck" = "true" ]; then
		if [ $time -ge 600 ] && [ $time -le 859 ]; then
			checkmorning
		elif [ $time -ge 900 ] && [ $time -le 1659 ]; then
			checkday
		elif [ $time -ge 1700 ] && [ $time -le 1959 ]; then
			checkevening
		elif ([ $time -ge 2000 ] && [ $time -le 2359 ]) || ([ $time -ge 0000 ] && [ $time -le 559 ]); then
			checknight
		fi
	#Transition wallpaper based on time
	elif [ $time -ge 600 ] && [ $time -le 859 ] && [ "$morningcheck" = "true" ]; then
		transmorning
	elif [ $time -ge 900 ] && [ $time -le 1659 ] && [ "$daycheck" = "true" ]; then
		transday
	elif [ $time -ge 1700 ] && [ $time -le 1959 ] && [ "$eveningcheck" = "true" ]; then
		transevening
	elif ([ $time -ge 2000 ] && [ $time -le 2359 ] && [ "$nightcheck" = "true" ]) || ([ $time -ge 0000 ] && [ $time -le 559 ] && [ '$nightcheck' = 'true' ]); then
		transnight
	fi
	sleep 10
done
